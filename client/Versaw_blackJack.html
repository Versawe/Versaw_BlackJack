<html>
<header>
	<title>
		Eric Versaw's Black Jack Game
	</title>
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
</header>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>

<script src = "https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.3.0/socket.io.js"></script>

<style>
	body{
		margin-top: 30px;

	}
	#messageArea{
		display: none;
	}
	
</style>

<body>
	<div class ="container">
		<div id="userFormArea" class="row">
			<div class="col-md-12">
				<form id="userForm">
						<div class="form-group">
							<label>Enter Username</label>
							<input class="form-control" id="username" />
							<br/>
							<input type="submit" class="btn btn-primary" value="Login" />

						</div>
					</form>
			</div>
		</div>
		<div id="messageArea" class="row">
			<div class="col-md-4">
				<div class="well">
					<h3>Online Users</h3>
					<ul class="list-group" id="users"></ul>
				</div>

			</div>
			<div class="col-md-8">
					<div class="chat" id="chat"></div>

					<form id="messageForm">
						<div class="form-group">
							<label>Enter Message</label>
							<textarea class="form-control" id="message"></textarea>
							<br>
							<input type="submit" class="btn btn-primary" value="Send Message" />

						</div>
					</form>
			</div>

			<div>
				<center>
				<h2>Black Jack</h2>
				<br>
				<input type="button" value="Send Variables to Server" onClick= "variablesToServer(); updateTextOnClients();"/>
				<br>
				<input type="button" value = "Recevive from Server" onClick = "receivedFromServer(); updateTextOnClients();"/>
				<br>
				<h2>Dealer Clicks to Deal</h2>
				<input type=button value="DEAL" onClick="dealCard(); finishGame();"/>
				<p>Face Up Card Dealt</p>
				<p id="dealerDelt"></p>
				<p id="dealerScore"></p>
				<br>
				<h2>Add your Bet</h2>
				<input type=button value ="Add Bet" onClick="addBet100();"/>
				<br>
				<input type=button value ="Remove Bet" onClick="removeBet100();"/>
				<p>Your Current bet</p>
				<p id="playerBet"></p>
				<p id="playerBank">Your current bank is $500</p>
				<br>
				<h2>Click to draw card</h2>
				<input type=button value="HIT" onClick="drawCard(); finishGame();" />
				<br>
				<input type=button value="HOLD" onClick="playerHold(); finishGame();"/>
				<br>
				<input type="button" value="DOUBLE DOWN" onClick="doubleDown(); finishGame();"/>

				<p>Card Drawn</p>
				<p id="playerDrew"></p>
				<p id="playerScore"></p>
				<p id = "endGame"></p>
				<br>
				<input type=button value="Reset Round" onClick="newRound();"/>

				</center>
			</div>

		</div>
		
	</div>

</body>

<script>
	var socket = io.connect();
		$(function(){
			var $messageForm = $('#messageForm');
			var $message = $('#message');
			var $chat = $('#chat');
			var $messageArea = $('#messageArea');
			var $userFormArea = $('#userFormArea');
			var $userForm = $('#userForm');
			var $users = $('#users');
			var $username = $('#username');

			$messageForm.submit(function(e){
				e.preventDefault();
				socket.emit('send message', $message.val());
				$message.val('');
			});

			socket.on('new message', function(data){
				$chat.append('<div class="well"><strong>'+data.user+'</strong>: ' +data.msg+'</div>');
			});

			$userForm.submit(function(e){
				e.preventDefault();
				socket.emit('new user', $username.val(), function(data){
					if(data){
						$userFormArea.hide();
						$messageArea.slideDown(1000);
					}
				});
				$username.val('');
			});

			socket.on('get users', function(data){
				var html = '';
				for(i = 0; i < data.length; i++){
					html += '<li class="list-group-item">'+data[i]+'</li>';
				}
				$users.html(html);
			});
		});

		var suit;

		var value;

		var isJack;
		var isKing;
		var isQueen;
		var isACE;

		var dealersTurn;
		var playersTurn;

		var dealersHand;
		var playersHand;

		var dealerFirstPlay;

		var playerHolds;
	    
	    var playerCash;
	    
	    var roundBet;

	    var firstCardPlayed;

	    var secondCardPlayed;

	    var thirdCardPlayed;

	    var playerDD;

	    receivedFromServer();

		//player's darw function
		function drawCard(){
			if(!dealersTurn && playersTurn && !playerHolds){
				suit = getSuit();

				value = getValue();
	            
	            if(playersTurn && firstCardPlayed && secondCardPlayed && !thirdCardPlayed){
					thirdCardPlayed = true;
				}
	            if(playersTurn && firstCardPlayed && !secondCardPlayed){
					secondCardPlayed = true;
				}
				if(playersTurn && !firstCardPlayed){
					firstCardPlayed = true;
				}
				
				if(!isJack && !isACE && !isQueen && !isKing){
					document.getElementById("playerDrew").innerHTML = "You drew the " + value + " of " + suit;
					document.getElementById("playerScore").innerHTML = playersHand;
				}
				if(isACE){
					document.getElementById("playerDrew").innerHTML = "You drew the Ace of " + suit;
					document.getElementById("playerScore").innerHTML = playersHand;
				}
				if(isKing){
					document.getElementById("playerDrew").innerHTML = "You drew the King of " + suit;
					document.getElementById("playerScore").innerHTML = playersHand;

				}
				if(isJack){
					document.getElementById("playerDrew").innerHTML = "You drew the Jack of " + suit;
					document.getElementById("playerScore").innerHTML = playersHand;

				}
				if(isQueen){
					document.getElementById("playerDrew").innerHTML = "You drew the Queen of " + suit;
					document.getElementById("playerScore").innerHTML = playersHand;

				}

				if(playerDD){
					document.getElementById("playerDrew").innerHTML = "Player is doubling down! The bet is up to " + roundBet + " now!";
				}

			}

		}

		function dealCard(){
			if(dealersTurn && !playersTurn){

				if(dealersHand < 17){

					suit = getSuit();

					value = getValue();

					if(!isJack && !isACE && !isQueen && !isKing){
						document.getElementById("dealerDelt").innerHTML = "Dealer Played " + value + " of " + suit;
						document.getElementById("dealerScore").innerHTML = dealersHand;
					}
					if(isACE){
						printVarDealer = "Dealer Played the Ace of " + suit;
						document.getElementById("dealerDelt").innerHTML = "Dealer Played the Ace of " + suit;
						document.getElementById("dealerScore").innerHTML = dealersHand;
					}
					if(isKing){
						document.getElementById("dealerDelt").innerHTML = "Dealer Played the King of " + suit;
						document.getElementById("dealerScore").innerHTML = dealersHand;

					}
					if(isJack){
						document.getElementById("dealerDelt").innerHTML = "Dealer Played the Jack of " + suit;
						document.getElementById("dealerScore").innerHTML = dealersHand;

					}
					if(isQueen){
						document.getElementById("dealerDelt").innerHTML = "Dealer Played the Queen of " + suit;
						document.getElementById("dealerScore").innerHTML = dealersHand;

					}

					if(dealerFirstPlay){
						dealersTurn = false;
						playersTurn = true;
						dealerFirstPlay = false;

					}

				}

			}

		}

		//function to get random suit
		function getSuit(){

			suitChoice = Math.floor(Math.random() * 4) + 1;

			if(suitChoice == 1){
				suitFinal = 'Diamonds';

			}
			if(suitChoice == 2){
				suitFinal = 'Hearts';

			}
			if(suitChoice == 3){
				suitFinal = 'Clubs';

			}
			if(suitChoice == 4){
				suitFinal = 'Spades';

			}


			return suitFinal;

		}

		//random function to get the value
		function getValue(){

			isJack = false;
			isKing = false;
			isQueen = false;
			isACE = false;

			valueChoice = Math.floor(Math.random() * 13) + 1;

			if(valueChoice == 1){
				valueFinal = 1;
				isACE = true;
				if(dealersTurn && !playersTurn){
					if(dealersHand > 10){
						dealersHand += 1;

					}
					if(dealersHand <= 10){
						dealersHand += 11;

					}

				}
				if(!dealersTurn && playersTurn){
					if(playersHand > 10){
						playersHand += 1;

					}
					if(playersHand <= 10){
						playersHand += 11;

					}
				}
				//ace
			}
			if(valueChoice == 2){
				valueFinal = 2;
				if(dealersTurn && !playersTurn){
					dealersHand += 2;

				}
				if(!dealersTurn && playersTurn){
					playersHand += 2;

				}

			}
			if(valueChoice == 3){
				valueFinal = 3;
				if(dealersTurn && !playersTurn){
					dealersHand += 3;

				}
				if(!dealersTurn && playersTurn){
					playersHand += 3;

				}

			}
			if(valueChoice == 4){
				valueFinal = 4;
				if(dealersTurn && !playersTurn){
					dealersHand += 4;

				}
				if(!dealersTurn && playersTurn){
					playersHand += 4;

				}

			}
			if(valueChoice == 5){
				valueFinal = 5;
				if(dealersTurn && !playersTurn){
					dealersHand += 5;

				}
				if(!dealersTurn && playersTurn){
					playersHand += 5;

				}

			}
			if(valueChoice == 6){
				valueFinal = 6;
				if(dealersTurn && !playersTurn){
					dealersHand += 6;

				}
				if(!dealersTurn && playersTurn){
					playersHand += 6;

				}

			}
			if(valueChoice == 7){
				valueFinal = 7;
				if(dealersTurn && !playersTurn){
					dealersHand += 7;

				}
				if(!dealersTurn && playersTurn){
					playersHand += 7;

				}

			}
			if(valueChoice == 8){
				valueFinal = 8;
				if(dealersTurn && !playersTurn){
					dealersHand += 8;

				}
				if(!dealersTurn && playersTurn){
					playersHand += 8;

				}

			}
			if(valueChoice == 9){
				valueFinal = 9;
				if(dealersTurn && !playersTurn){
					dealersHand += 9;

				}
				if(!dealersTurn && playersTurn){
					playersHand += 9;

				}

			}
			if(valueChoice == 10){
				valueFinal = 10;
				if(dealersTurn && !playersTurn){
					dealersHand += 10;

				}
				if(!dealersTurn && playersTurn){
					playersHand += 10;

				}

			}
			if(valueChoice == 11){
				valueFinal = 10;
				isJack = true;
				if(dealersTurn && !playersTurn){
					dealersHand += 10;

				}
				if(!dealersTurn && playersTurn){
					playersHand += 10;

				}
				//jack
			}
			if(valueChoice == 12){
				valueFinal = 10;
				isQueen = true;
				if(dealersTurn && !playersTurn){
					dealersHand += 10;

				}
				if(!dealersTurn && playersTurn){
					playersHand += 10;

				}
				//queen
			}
			if(valueChoice == 13){
				valueFinal = 10;
				isKing = true;
				if(dealersTurn && !playersTurn){
					dealersHand += 10;

				}
				if(!dealersTurn && playersTurn){
					playersHand += 10;

				}
				//king
			}


			return valueFinal;
		}

		function newRound(){
			suit = '';

			value = 0;

			isJack = false;
			isKing = false;
			isQueen = false;
			isACE = false;

			dealersTurn = true;
			playersTurn = false;

			dealersHand = 0;
			playersHand = 0;

			dealerFirstPlay = true;
			playerHolds = false;

			playerCash = roundBet + playerCash;

			roundBet = 0;

			firstCardPlayed = false;
			secondCardPlayed = false;
			thirdCardPlayed = false;

			playerDD = false;

			document.getElementById("playerScore").innerHTML = "";
			document.getElementById("dealerScore").innerHTML = "";
			document.getElementById("playerDrew").innerHTML = "";
			document.getElementById("dealerDelt").innerHTML = "";
			document.getElementById("endGame").innerHTML = "";
			document.getElementById("playerBet").innerHTML = "";
	        document.getElementById("playerBank").innerHTML = "Your current bank is $" + playerCash;

		}

		function finishGame(){
			if(dealersHand >= 17 && dealersHand < playersHand){
				document.getElementById("endGame").innerHTML = "Dealer cannot play anymore. YOU WIN!!!";
				dealersTurn = false;
				playersTurn = false;

				roundBet = roundBet * 2;
			}
			if(dealersHand == playersHand && dealersHand >= 17){
				document.getElementById("endGame").innerHTML = "TIE GAME! Try again...";
				dealersTurn = false;
				playersTurn = false;

			}
			if(dealersHand > playersHand && playerHolds && dealersHand <= 21){
				document.getElementById("endGame").innerHTML = "Dealer beats your score. DEALER WINS!!!";
				dealersTurn = false;
				playersTurn = false;

				roundBet = 0;

			}
			if(dealersHand > playersHand && playerDD && dealersHand <= 21){
				document.getElementById("endGame").innerHTML = "Dealer beats your score. DEALER WINS!!!";
				dealersTurn = false;
				playersTurn = false;

				roundBet = 0;

			}
			if(playersHand > 21){
				playersTurn = false;
				dealersTurn = false;
				document.getElementById("endGame").innerHTML = "You BUSTED!!";

				roundBet = 0;
			}
			if(dealersHand > 21){
				playersTurn = false;
				dealersTurn = false;
				document.getElementById("endGame").innerHTML = "Dealer BUSTED!! You Win!!";

				roundBet = roundBet * 2;
			}

		}

		function playerHold(){
			if(playersTurn && !dealersTurn){
				document.getElementById("playerDrew").innerHTML = "Player is holding at " + playersHand;
				playersTurn = false;
				dealersTurn = true;
				playerHolds = true;

			}
			
		}
	    
	    function addBet100(){
	    	if(playersTurn && !dealersTurn && !firstCardPlayed){
	    		if(playerCash >= 100){
		            playerCash -= 100;
		            roundBet += 100;

		            document.getElementById("playerBet").innerHTML = "Player's current bet is " + roundBet;
	        		document.getElementById("playerBank").innerHTML = "Your current bank is $" + playerCash;
		        }

	    	}

	    }

	    function removeBet100(){
	    	if(playersTurn && !dealersTurn && !firstCardPlayed){
	    		if(roundBet >= 100){
		            roundBet -= 100;
		            playerCash += 100;

		            document.getElementById("playerBet").innerHTML = "Player's current bet is " + roundBet;
	        		document.getElementById("playerBank").innerHTML = "Your current bank is $" + playerCash;
		        }
	    	}

	    }

	    function doubleDown(){
	    	if(playersTurn && secondCardPlayed && !thirdCardPlayed){
	    		if(roundBet > 0 && playerCash >= roundBet){
	    			playerDD = true;
	    			playerCash = playerCash - roundBet;
		    		roundBet = roundBet * 2;
		    		document.getElementById("playerBet").innerHTML = "Player's current bet is " + roundBet;
		        	document.getElementById("playerBank").innerHTML = "Your current bank is $" + playerCash;
		    		drawCard();
		    		playersTurn = false;
		    		dealersTurn = true;

	    		}
	    		
	    	}
	    }

	    function variablesToServer(){

	    	socket.emit('update variable 1',{
	    		var1: suit

		    	});
		    socket.emit('update variable 2',{
		    		var2: value

		    	});
		    socket.emit('update variable 3',{
		    		var3: isJack

		    	});
		    socket.emit('update variable 4',{
		    		var4: isQueen

		    	});
		    socket.emit('update variable 5',{
		    		var5: isKing

		    	});
		    socket.emit('update variable 6',{
		    		var6: isACE

		    	});
		    socket.emit('update variable 7',{
		    		var7: dealersTurn

		    	});
		    socket.emit('update variable 8',{
		    		var8: playersTurn

		    	});
		    socket.emit('update variable 9',{
		    		var9: dealersHand

		    	});
		    socket.emit('update variable 10',{
		    		var10: playersHand

		    	});
		    socket.emit('update variable 11',{
		    		var11: dealerFirstPlay

		    	});
		    socket.emit('update variable 12',{
		    		var12: playerHolds

		    	});
		    socket.emit('update variable 13',{
		    		var13: playerCash

		    	});
		    socket.emit('update variable 14',{
		    		var14: roundBet

		    	});
		    socket.emit('update variable 15',{
		    		var15: firstCardPlayed

		    	});
		    socket.emit('update variable 16',{
		    		var16: secondCardPlayed

		    	});
		    socket.emit('update variable 17',{
		    		var17: thirdCardPlayed

		    	});
		    socket.emit('update variable 18',{
		    		var18: playerDD

		    	});
	    }

	    function receivedFromServer(){
	    	socket.on('server to client 1', function(data){
	    		suit = data.toclient1;
	 
	    	});
	    	socket.on('server to client 2', function(data){
	    		value = data.toclient2;
	    		
	    	});
	    	socket.on('server to client 3', function(data){
	    		isJack = data.toclient3;
	    		
	    	});
	    	socket.on('server to client 4', function(data){
	    		isKing = data.toclient4;
	    		
	    	});
	    	socket.on('server to client 5', function(data){
	    		isQueen = data.toclient5;
	    		
	    	});
	    	socket.on('server to client 6', function(data){
	    		isACE = data.toclient6;
	    		
	    	});
	    	socket.on('server to client 7', function(data){
	    		dealersTurn = data.toclient7;
	    		
	    	});
	    	socket.on('server to client 8', function(data){
	    		playersTurn = data.toclient8;
	    		
	    	});
	    	socket.on('server to client 9', function(data){
	    		dealersHand = data.toclient9;
	    		
	    	});
	    	socket.on('server to client 10', function(data){
	    		playersHand = data.toclient10;
	    		
	    	});
	    	socket.on('server to client 11', function(data){
	    		dealerFirstPlay = data.toclient11;
	    		
	    	});
	    	socket.on('server to client 12', function(data){
	    		playerHolds = data.toclient12;
	    		
	    	});
	    	socket.on('server to client 13', function(data){
	    		playerCash = data.toclient13;
	    		
	    	});
	    	socket.on('server to client 14', function(data){
	    		roundBet = data.toclient14;
	    		
	    	});
	    	socket.on('server to client 15', function(data){
	    		firstCardPlayed = data.toclient15;
	    		
	    	});
	    	socket.on('server to client 16', function(data){
	    		secondCardPlayed = data.toclient16;
	    		
	    	});
	    	socket.on('server to client 17', function(data){
	    		thirdCardPlayed = data.toclient17;
	    		
	    	});
	    	socket.on('server to client 18', function(data){
	    		playerDD = data.toclient18;
	    		
	    	});
	    }

	    function updateTextOnClients(){
			document.getElementById("playerBet").innerHTML = "Player's current bet is " + roundBet;
	        document.getElementById("playerBank").innerHTML = "Your current bank is $" + playerCash;
	        document.getElementById("playerScore").innerHTML = playersHand;
	        document.getElementById("dealerScore").innerHTML = dealersHand;
	        finishGame();
	    }


</script>


</html>